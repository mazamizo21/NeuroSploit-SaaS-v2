# TazoSploit Exploitation Gap Analysis

**Date:** 2026-02-12  
**Author:** Subagent deep-dive analysis  
**Problem:** Agent finds vulnerabilities but doesn't properly exploit them — marks things "proven" with weak evidence

---

## 1. Lessons from Open Source AI Pentest Projects

### PentAGI (Go, 1k+ stars)
- **Multi-agent architecture:** pentester, adviser, coder, searcher, memorist, reflector, subtasks_generator
- **Key insight:** Dedicated `coder` agent writes custom exploits when standard tools fail
- **Reflector agent** catches when the AI produces text instead of tool calls
- **HackResult barrier** — agent MUST call structured final report tool to complete (forces proof)
- **Knowledge graph** stores ALL execution history; agent searches "what worked before" first

### PentestGPT (Python, USENIX Security 2024)
- **Single-agent** but with extremely aggressive exploitation-focused system prompt
- **Core principle:** "Having RCE is NOT completion — use it to read user.txt and root.txt"
- **5 fallback strategies** when exploitation fails (different shells, encodings, ports, protocols)
- **Detailed privesc checklist:** SUID, cron, capabilities, sudo, writable files, kernel version
- **"NEVER GIVE UP"** directive — persistence until flags are found
- **Penetration Testing Tree (PTT):** Structured task tree tracking to-do/completed per step

---

## 2. Root Cause Analysis — What TazoSploit Is Missing

| # | Gap | Impact | Fix |
|---|-----|--------|-----|
| 1 | System prompt weak on exploitation specifics | Agent runs recon and stops | Rewrite SYSTEM_PROMPT_BASE with exploitation directives |
| 2 | No "exploitation is not complete until X" | Agent marks finding as exploit | Add completion criteria to prompt |
| 3 | No fallback strategies | Single tool fails → gives up | Add fallback escalation ladder |
| 4 | No post-exploit checklist | Gets creds but doesn't use them | Add post-exploit actions to prompt |
| 5 | Proof gate too weak | Accepts echo/curl as "proof" | Tighten `_proof_ok_for_vuln()` |
| 6 | No exploit development | Can't write custom scripts | Future: coder sub-agent |
| 7 | No post-exploitation nudge | Pivots away after proof | Inject deepening message |

---

## 3. Changes Implemented

### A. SYSTEM_PROMPT_BASE Rewrite

**Before (lines 261-290):**
- Generic format instructions
- Brief tool list
- "searchsploit → msfconsole/sqlmap/commix/curl → capture proof in stdout"
- No exploitation-completion criteria
- No fallback strategies
- Post-exploit was a single line listing commands

**After:**
- **Exploitation completion directive:** "FINDING a vulnerability is NOT completion — EXPLOITING it is"
- **Real proof definition:** Data dumps, file contents with sensitive data, shell output with uid=/whoami, DB table contents, extracted credentials
- **Fallback ladder:** When Tool A fails, try Tool B, then manual exploitation, then custom scripts
- **Post-exploitation deepening:** After initial proof, dump full DB, read sensitive files, escalate privileges
- **Never give up:** Persistence directive — vary techniques, don't repeat failures
- **Kept compact:** ~2800 chars, focused and actionable

### B. Proof Validation Tightening (`_proof_ok_for_vuln_inner`)

**Added: Weak-evidence rejection gate** (runs before all vuln-specific checks)

Commands rejected as insufficient proof:
- `echo` commands (testing write but not exploiting)
- `mkdir`/`touch` (filesystem side-effects, not data extraction)
- `ls`/`cat` without sensitive content in output
- `ping`/`traceroute` (network reachability, not exploitation)
- `curl` that just gets a 200 OK with no sensitive data
- Any command whose output is less than 20 chars

Evidence keywords required (at least one):
- Identity: uid=, root:x:, whoami output, nt authority
- Data: table names, database dumps, password/credential/hash patterns
- File contents: /etc/passwd, /etc/shadow, .env, config, key material
- Shell markers: $, #, >, command prompts indicating interactive shell

### C. Post-Exploitation Nudge

**Added to `_mark_vuln_proven()`:** After marking a vuln proven, inject a post-exploitation deepening message telling the agent to:
1. Dump the full database (not just prove access)
2. Read sensitive files (/etc/shadow, config files, .env, private keys)
3. Check for privilege escalation (SUID, sudo -l, capabilities, cron jobs)
4. Use discovered credentials for lateral movement
5. Extract maximum value before pivoting to the next target

This fires BEFORE the auto-pivot message, giving the agent one iteration to deepen exploitation before moving on.

---

## 4. Before/After Comparison

### System Prompt — Exploitation Section
**Before:**
```
**EXPLOIT FLOW:** searchsploit → msfconsole/sqlmap/commix/curl → capture proof in stdout. Max 2 enum iterations per finding — move to exploitation.
**EVIDENCE:** Concrete proof only (data dumps, file reads, shell output). Tag: [REMEMBER: ...]
```

**After:**
```
**EXPLOITATION IS MANDATORY:** FINDING a vulnerability is NOT completion. You MUST exploit it to extract data, gain access, or demonstrate impact. 
...
**REAL PROOF means:** extracted DB rows/tables, file contents (passwd, shadow, configs, keys), shell output showing uid=/whoami/id, stolen credentials/tokens used to access protected resources, dumped hashes. NOT: echo commands, HTTP 200 responses, "vulnerable" text, mkdir/touch side effects.
...
**FALLBACK LADDER:** If Tool A fails → try Tool B → try manual exploitation → write a custom script.
```

### Proof Validation
**Before:** Accepted any output from a command that matched exploit-intent heuristics
**After:** Pre-filter rejects trivially weak evidence (echo, mkdir, ping, short output) before vuln-specific checks run

### Post-Proof Behavior
**Before:** Immediately pivots to next unproven vuln
**After:** Injects deepening nudge first, THEN pivots on next iteration

---

## 5. Future Improvements (Not Implemented Yet)

1. **Coder sub-agent** — Write custom exploit scripts when standard tools fail (à la PentAGI)
2. **Strategic advisor** — When stuck after N attempts, consult an advisor prompt for new approaches
3. **Reflector** — Detect when agent is producing analysis text instead of running commands
4. **Exploit knowledge base** — Store successful exploit patterns for reuse (à la PentAGI's memorist)
5. **Penetration Testing Tree** — Structured task tracking (à la PentestGPT's PTT)
