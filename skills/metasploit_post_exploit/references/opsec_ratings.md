# OPSEC Ratings for Metasploit Post-Exploitation

## Rating System
- ðŸŸ¢ **Quiet** â€” In-memory only, no disk writes, minimal logging
- ðŸŸ¡ **Moderate** â€” Some disk I/O, creates logs, may trigger basic monitoring
- ðŸ”´ **Loud** â€” Creates services/processes, triggers alerts, leaves artifacts

## Enumeration Commands

| Command | OPSEC | Notes |
|---------|-------|-------|
| `sysinfo` | ðŸŸ¢ | In-memory API call |
| `getuid` | ðŸŸ¢ | In-memory |
| `getprivs` | ðŸŸ¢ | In-memory token query |
| `ipconfig` | ðŸŸ¢ | In-memory |
| `ps` | ðŸŸ¢ | In-memory process list |
| `arp` | ðŸŸ¢ | In-memory ARP cache |
| `route` | ðŸŸ¢ | In-memory routing table |
| `netstat` | ðŸŸ¢ | In-memory (but may log on EDR) |
| `run post/windows/gather/enum_system` | ðŸŸ¢ | WMI queries |
| `run post/windows/gather/enum_patches` | ðŸŸ¢ | WMI queries |
| `run post/windows/gather/checkvm` | ðŸŸ¢ | Registry/WMI checks |

## Credential Harvesting

| Technique | OPSEC | Detection Risk |
|-----------|-------|----------------|
| `hashdump` | ðŸŸ¡ | Touches SAM registry hive â€” may alert EDR |
| `load kiwi` â†’ `creds_all` | ðŸŸ¡ | LSASS access â€” high EDR detection risk |
| `creds_wdigest` | ðŸŸ¡ | LSASS memory read |
| `kiwi_cmd lsadump::sam` | ðŸŸ¡ | SAM/SYSTEM hive access |
| `kiwi_cmd lsadump::secrets` | ðŸŸ¡ | LSA registry access |
| `kiwi_cmd lsadump::dcsync` | ðŸŸ¡ | DRSUAPI replication â€” DC logs event 4662 |
| `run post/windows/gather/cachedump` | ðŸŸ¡ | Registry access |
| `run post/multi/gather/ssh_creds` | ðŸŸ¢ | File reads only |
| Token impersonation | ðŸŸ¢ | In-memory token manipulation |

## Privilege Escalation

| Technique | OPSEC | Detection Risk |
|-----------|-------|----------------|
| `getsystem` (Named Pipe) | ðŸŸ¡ | Creates named pipe â€” may trigger rules |
| `getsystem` (Token Dup) | ðŸŸ¢ | In-memory token operation |
| UAC bypass (eventvwr) | ðŸŸ¡ | Registry modification + process creation |
| UAC bypass (fodhelper) | ðŸŸ¡ | Registry modification + process creation |
| Local exploit (kernel) | ðŸ”´ | May crash system, creates memory artifacts |
| Potato exploits | ðŸŸ¡ | Named pipe + token manipulation |
| `local_exploit_suggester` | ðŸŸ¢ | Read-only system info check |

## Lateral Movement

| Technique | OPSEC | Detection Risk |
|-----------|-------|----------------|
| PsExec | ðŸ”´ | Creates service, writes to disk, logs event 7045 |
| PsExec_psh | ðŸŸ¡ | PowerShell execution, less disk artifacts |
| WMI exec | ðŸŸ¡ | WMI event logs, process creation |
| WinRM | ðŸŸ¢ | Standard admin protocol, less suspicious |
| SSH | ðŸŸ¢ | Standard protocol, auth logging only |
| Token reuse (net use) | ðŸŸ¢ | Standard SMB, normal-looking traffic |
| RDP | ðŸŸ¡ | Login events, screen recording risk |
| DCOM | ðŸŸ¡ | Less common, may be logged |

## Persistence

| Mechanism | OPSEC | Detection Risk |
|-----------|-------|----------------|
| Registry Run Keys | ðŸŸ¡ | Registry modification â€” monitored by EDR |
| Scheduled Task | ðŸŸ¡ | Task creation event (4698), visible in taskschd |
| Windows Service | ðŸ”´ | Service creation event (7045), visible in services.msc |
| WMI subscription | ðŸ”´ | Complex event, harder to detect but suspicious |
| SSH authorized_keys | ðŸŸ¢ | File modification only |
| Cron job | ðŸŸ¢ | File modification, rarely monitored |
| Systemd service | ðŸŸ¡ | Service creation, visible in systemctl |
| Web shell | ðŸŸ¡ | File on disk â€” AV/WAF may detect |
| Startup folder | ðŸŸ¢ | File copy â€” basic but effective |
| LD_PRELOAD | ðŸ”´ | System-wide, breaks things if wrong |

## Pivoting

| Technique | OPSEC | Detection Risk |
|-----------|-------|----------------|
| AutoRoute | ðŸŸ¢ | Metasploit-internal, no network artifact |
| SOCKS proxy | ðŸŸ¢ | Traffic tunneled through existing session |
| Port forward | ðŸŸ¢ | Additional connections from compromised host |
| Double pivot | ðŸŸ¢ | Same as single pivot, more latency |

## Best Practices for Stealth
1. **Migrate first** â€” move to a stable, common process (svchost.exe, explorer.exe)
2. **Use in-memory techniques** â€” kiwi/incognito over disk-based tools
3. **Avoid PsExec** â€” prefer WinRM or token-based access for lateral movement
4. **Time operations** â€” run noisy actions during business hours when log volume is high
5. **Clean up** â€” remove uploaded files, clear relevant logs (if authorized)
6. **Minimize beacon frequency** â€” use longer sleep intervals for persistence callbacks
