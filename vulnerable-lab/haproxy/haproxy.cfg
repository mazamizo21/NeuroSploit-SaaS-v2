# HAProxy Configuration - Vulnerable Load Balancer
# Intentionally misconfigured for penetration testing

global
    log stdout format raw local0
    maxconn 4096
    # Vulnerable: Stats page exposed without authentication

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

# Stats page - NO AUTHENTICATION (vulnerable)
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
    # NO stats auth - intentionally vulnerable

# Frontend - Entry point
frontend http_front
    bind *:80
    
    # Route based on path
    acl is_dvwa path_beg /dvwa
    acl is_dvna path_beg /dvna
    acl is_juice path_beg /juice
    acl is_webgoat path_beg /webgoat
    acl is_api path_beg /api
    
    # Default backend selection
    use_backend dvwa_backend if is_dvwa
    use_backend dvna_backend if is_dvna
    use_backend juice_backend if is_juice
    use_backend webgoat_backend if is_webgoat
    use_backend api_backend if is_api
    
    # Default to DVWA
    default_backend dvwa_backend

# Backend definitions
backend dvwa_backend
    balance roundrobin
    option httpchk GET /
    # Vulnerable: No health check authentication
    server dvwa1 10.0.2.20:80 check

backend dvna_backend
    balance roundrobin
    option httpchk GET /
    server dvna1 10.0.2.21:9090 check

backend juice_backend
    balance roundrobin
    option httpchk GET /
    server juice1 10.0.2.22:3000 check

backend webgoat_backend
    balance roundrobin
    option httpchk GET /WebGoat/
    server webgoat1 10.0.2.23:8080 check

backend api_backend
    balance roundrobin
    option httpchk GET /health
    server api1 10.0.2.24:5000 check
